<!DOCTYPE html>
<html dir="ltr" lang="fr-FR">
<head>
    <title>Outils pour les étudiants et leur professeurs</title>
	<script type="text/javascript" src="jquery-1.7.2.min.js"></script>
	<script type="text/javascript" src="./jquery.iscroll/jquery.iscroll.js"></script>
	<link rel="stylesheet" href="./jquery.iscroll/jquery.iscroll.css" media="all"/>
	<script>
		$(document).ready(function(){
			var html = '';
			var rand = 1000 + Math.random() * 1000;
			var h1 = 0;
			var h2 = 0;
			for (var i=0; i<rand; i++) {
				if (i%19==0) {
					h1++;
					h2 = 0;
					html += '<h1>titre: '+(h1)+'</h1>';
				}
				if (i%7==0) { 
					h2++;
					html += '<h2>sous-titre: '+h1+'.'+(h2)+'</h2>';
				}
				html += '<p>text<p>';
			}
			$(".demo1").html(html);
			
			var html = '';
			var rand = 25 + Math.random() * 100;
			var h1 = 0;
			var h2 = 0;
			for (var i=0; i<rand; i++) {
				if (i%43==0) {
					h1++;
					h2 = 0;
					html += '<h1>titre: '+(h1)+'</h1>';
				}
				if (i%9==0) { 
					h2++;
					html += '<h2>sous-titre: '+h1+'.'+(h2)+'</h2>';
				}
				html += '<p>text<p>';
			}
			$(".demo2").html(html);
			
			
			
			
			$(".demo")
				.iScroll({
					selector: 'h1,h2'
				})
				.bind('iscroll:message', function (event) {
					
					if(event.datas[0]) {
						var h1 = false,
							h2 = false;
							percent = event.scrollpercent,
							k = event.datas.length/2, 
							dk = k/2;
						
						while(k > 0 && dk > 0) {
							if (event.datas[Math.floor(k)].scrollpercent < percent) {
								k += dk;
							} else if (event.datas[Math.floor(k)].scrollpercent > percent) {
								k -= dk;
							} else {
								break;
							}
							if (dk <= 0.5) {
								k = Math.ceil(k);
								break;
							}
							dk = dk/2;
						}
						while (k && (!event.datas[k] || event.datas[k].scrollpercent > percent)) {
							k--;
						}
						
						for (var k = k; k >= 0 && !(h1 && h2); k--) {
							if (event.datas[k].DOM.nodeName=='H1') {
								if (!h1) h1 = event.datas[k];
							}
							else if (!h2 && (!h1 || h1.scrollpercent < event.datas[k].scrollpercent))
								h2 = event.datas[k];
							else if (h1 && h1.scrollpercent >= event.datas[k].scrollpercent)
								break;
						}
						
						return (h1 ? h1.DOM.innerHTML : '') + '<br/>' + (h2 ? h2.DOM.innerHTML : '.');
					}
				});
			
			$(".demo1").append('<span class="truc"></span>');
			$(".demo1 .truc").css('display', 'block');
			$(".demo1").append('<span class="truc2"></span>');
			
			$(".demo1")
				.bind('iscroll:start', function (event) {
					$(".disp1").html(event.type);
				})
				.bind('iscroll:move', function (event) {
					$(".disp1").html(event.type +' '+ event.deltaY);
				})
				.bind('iscroll:stop', function (event) {
					$(".disp1").html(event.type);
				});
			$(".demo2")
				.bind('iscroll:start', function (event) {
					$(".disp2").html(event.type);
				})
				.bind('iscroll:move', function (event) {
					$(".disp2").html(event.type +' '+ event.deltaY);
				})
				.bind('iscroll:stop', function (event) {
					$(".disp2").html(event.type);
				});
		});
	</script>
	<style>
		.pos {
			float: left;
		}
		.disp {
			height: 20px;
			background: #dddddd;
		}
		.demo1 {
			height: 500px;
			width: 500px;
			margin-right:30px;
		}
		.demo2 {
			height: 300px;
			width: 550px;
			margin-top: 50px;
		}
	</style>
</head>
<body>
	<div class="pos">
		<div class="disp disp1"></div>
		<div class="demo demo1"></div>
	</div>
	<div class="pos">
		<div class="disp disp2"></div>
		<div class="demo demo2"></div>
	</div>
</body>
</html>
